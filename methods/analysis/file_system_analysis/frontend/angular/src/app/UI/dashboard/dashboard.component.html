<div class="app-container">
    <div class="app-bar">
        <span class="main-title">
        <b>FILE SYSTEM ANALYSIS</b>
        </span>
        <div class="settings">
            <span class="glyphicon glyphicon-menu-hamburger clickable" [matMenuTriggerFor]="settings"></span>
            <mat-menu #settings="matMenu" [overlapTrigger]="false">
                <button mat-menu-item (click)="setupWindowOpen = !setupWindowOpen">
                    <span>SETUP</span>
                </button>
                <button mat-menu-item (click)="advancedModeToggle(!advancedMode)">
                    ADVANCED MODE
                    <input type="checkbox" [ngModel]="advancedMode" class="timesix-slider" id="advancedModeCheckbox">
                    <label for="advancedModeCheckbox"></label>
                </button>
                <button mat-menu-item (click)="saveApplicationState()">
                    SAVE STATE
                </button>
                <button mat-menu-item routerLink="/upload" routerLinkActive="active">
                    <span>UPLOAD NEW FILE</span>
                </button>
                <button mat-menu-item (click)="logout()" >
                    <span>LOG OUT</span>
                </button>
            </mat-menu>
        </div>
    </div>

    <div *ngIf="setupWindowOpen" class="setup-window">
        <div class="setup-tab col-sm-6 col-sm-offset-3">
            <div class="col-sm-2 col-sm-offset-2 setup-tab-text">
                <b>DATASET</b>
            </div>
            <div class="col-sm-6">
                <mat-form-field>
                    <mat-select [(value)]="selectedCase" (click)="loadAllCases()" placeholder="Click to select dataset">
                        <mat-option>None</mat-option>
                        <mat-option *ngFor="let case of cases" [value]="case['key']">{{case['key']}}</mat-option>
                    </mat-select>
                </mat-form-field>
            </div>
            <div class="col-sm-5 setup-tab-button">
                <button mat-stroked-button (click)="restoreApplicationState()" class="timesix-button"
                        [disabled]="!ableToRestoreState()">
                    RESTORE STATE
                </button>
            </div>
            <div class="col-sm-5 setup-tab-button">
                <button mat-stroked-button (click)="selectedCaseChanged()" class="timesix-button"
                        [disabled]="selectedCase == null">SELECT CASE
                </button>
            </div>
        </div>
    </div>
    <div class="container-edit-filter" *ngIf="editedClusters.size > 0 && advancedMode">
        <div class="filter-setup-background">
            <div *ngFor="let cluster of editedClusters">
                <app-filter [inputCluster]="cluster" (editDone)="editDone($event)"></app-filter>
            </div>
        </div>
    </div>

    <div [ngClass]="{'container-all-opened': clusterPanelOpenState, 'container-all-closed': !clusterPanelOpenState}">
        <div class="grid-cluster panel">
            <div class="panel-header">
                <span class="text-gray"><b>CLUSTERS</b></span>
                <span class="glyphicon panel-header-button"
                      [ngClass]="{'glyphicon-chevron-down': !clusterPanelOpenState, 'glyphicon-chevron-up': clusterPanelOpenState}"
                      (click)="clusterPanelOpenState = !clusterPanelOpenState"></span>
            </div>
            <div [ngClass]="{'panel-hidden': !clusterPanelOpenState, 'panel-visible': clusterPanelOpenState}"
                 class="panel-content col-md-12">
                <app-cluster
                        [clusters]="getClusters()"
                        [advancedMode]="advancedMode"
                        (selectionChanged)="clusterSelectionChanged($event)"
                        (addNewCluster)="addNewCluster()"
                        (editCluster)="editCluster($event)">
                </app-cluster>
            </div>
        </div>
        <div class="grid-main">
            <app-graph class="graph-block" [_case]="selectedCase" [_clusters]="getClusters()"
                       (getDateChange)="changeDateBoundary($event)"
                       (typesChanged)="selectedMetadataTypesChanged($event)">
            </app-graph>
            <app-list-view class="list-view-block" (graphChangedBoundary)="changeDateBoundary($event)"
                           (makeManualCluster)="makeManualCluster($event)"
                           (additionalFiltersChanged)="computeClustersItemCount($event)"
                           (actualScrollPosition)="drawActualScrollPosition($event)"
            ></app-list-view>
        </div>
    </div>
</div>
